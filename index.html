<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLIP — Red Social para Artistas</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
body{background:#0f1117;color:#fff;}
header{position:fixed;top:0;width:100%;height:70px;background:#151822;display:flex;align-items:center;justify-content:space-between;padding:0 20px;z-index:1000;}
.logo{font-size:26px;color:#7b5cff;}
nav button{background:none;border:none;color:#fff;margin-left:15px;cursor:pointer;opacity:.7;}
nav button:hover{opacity:1;}
main{padding-top:90px;max-width:1400px;margin:auto;}
.grid{column-count:5;column-gap:16px;padding:20px;}
@media(max-width:1200px){.grid{column-count:4;}}
@media(max-width:900px){.grid{column-count:3;}}
@media(max-width:600px){.grid{column-count:2;}}
.card{background:#151822;margin:0 0 16px;border-radius:16px;overflow:hidden;break-inside:avoid;box-shadow:0 6px 25px rgba(0,0,0,.35);transition:.3s;}
.card:hover{transform:translateY(-5px);}
.card img{width:100%;display:block;}
.card .info{padding:12px;}
.card h3{font-size:14px;font-weight:500;margin-bottom:6px;}
.card p{font-size:12px;color:#9ca3af;}
.floating{position:fixed;right:25px;bottom:25px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#7b5cff,#4cc9f0);display:flex;align-items:center;justify-content:center;font-size:32px;cursor:pointer;box-shadow:0 10px 25px rgba(0,0,0,.5);z-index:9999;pointer-events:auto;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:10000;}
.modal-content{background:#151822;width:90%;max-width:420px;border-radius:18px;padding:25px;}
.modal-content h2{margin-bottom:15px;}
.modal-content input{width:100%;background:#0f1117;border:1px solid #2a2d3a;border-radius:10px;padding:10px;color:#fff;margin-bottom:12px;}
.modal-content button{width:100%;padding:12px;border:none;border-radius:12px;background:linear-gradient(135deg,#7b5cff,#4cc9f0);color:#fff;font-weight:600;cursor:pointer;}
</style>
</head>
<body>
<header>
  <div class="logo">BLIP</div>
  <nav id="nav">
    <button onclick="showFeed()">Inicio</button>
    <button onclick="showExplore()">Explorar</button>
    <button onclick="showProfile()">Perfil</button>
    <button onclick="openAuth()">Login</button>
  </nav>
</header>

<main>
  <section id="feed" class="grid"></section>
  <section id="explore" class="grid" style="display:none"></section>
  <section id="profile" style="display:none">
    <div id="profileGrid" class="grid"></div>
  </section>
</main>

<div class="floating" id="uploadBtn">+</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h2>Subir arte</h2>
    <input type="file" id="imgInput">
    <input type="text" id="imgTitle" placeholder="Título">
    <button onclick="addPost()">Publicar</button>
  </div>
</div>

<div class="modal" id="authModal">
  <div class="modal-content">
    <h2 id="authTitle">Iniciar sesión</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Contraseña">
    <button onclick="login()">Entrar</button>
    <p style="margin-top:10px;text-align:center;color:#9ca3af">
      ¿No tienes cuenta? <span style="color:#7b5cff;cursor:pointer" onclick="toggleAuth()">Regístrate</span>
    </p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyA5yh8J7Mgij3iZCOEZ2N8r1yhDkLcXsTg",
  authDomain: "almacenamiento-redsocial.firebaseapp.com",
  databaseURL: "https://almacenamiento-redsocial-default-rtdb.firebaseio.com",
  projectId: "almacenamiento-redsocial",
  storageBucket: "almacenamiento-redsocial.appspot.com",
  messagingSenderId: "562861595597",
  appId: "1:562861595597:web:a88c0af7d0c8da44a9c284"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const feed = document.getElementById('feed');
const profile = document.getElementById('profile');
const profileGrid = document.getElementById('profileGrid');
const explore = document.getElementById('explore');
const modal = document.getElementById('modal');
const authModal = document.getElementById('authModal');

// Navegación
function showFeed(){feed.style.display='grid';profile.style.display='none';explore.style.display='none';}
function showProfile(){feed.style.display='none';profile.style.display='grid';explore.style.display='none';}
function showExplore(){feed.style.display='none';profile.style.display='none';explore.style.display='grid';}

// Botón subir
document.getElementById('uploadBtn').addEventListener('click',()=>{modal.style.display='flex';});
modal.onclick=e=>{if(e.target===modal)modal.style.display='none';};
authModal.onclick=e=>{if(e.target===authModal)authModal.style.display='none';};

// Cloudinary
async function uploadToCloudinary(file){
    const cloudName = "dz9s37bk0";
    const uploadPreset = "blip_unsigned";
    const url = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;
    const formData = new FormData();
    formData.append("file",file);
    formData.append("upload_preset",uploadPreset);
    const res = await fetch(url,{method:"POST",body:formData});
    const data = await res.json();
    return data.secure_url;
}

// Guardar post
async function addPost(){
    const file = document.getElementById('imgInput').files[0];
    const title = document.getElementById('imgTitle').value || "Arte BLIP";
    if(!file) return alert("Selecciona una imagen");
    const url = await uploadToCloudinary(file);
    const postRef = push(ref(db,'posts'));
    set(postRef,{url,title,user:auth.currentUser.email,date:Date.now()});
    modal.style.display='none';
}

// Mostrar feed
onValue(ref(db,'posts'),snapshot=>{
    feed.innerHTML=''; profileGrid.innerHTML='';
    snapshot.forEach(s=>{
        const p = s.val();
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML=`<img src="${p.url}"><div class="info"><h3>${p.title}</h3><p>${p.user}</p></div>`;
        feed.prepend(card);
        const clone = card.cloneNode(true);
        profileGrid.prepend(clone);
    });
});

// Auth
let isLogin=true;
function toggleAuth(){isLogin=!isLogin;document.getElementById('authTitle').innerText=isLogin?'Iniciar sesión':'Crear cuenta';}
function login(){
    const email=document.getElementById('email').value;
    const pass=document.getElementById('password').value;
    if(isLogin){
        signInWithEmailAndPassword(auth,email,pass).then(()=>authModal.style.display='none').catch(e=>alert(e.message));
    }else{
        createUserWithEmailAndPassword(auth,email,pass).then(()=>authModal.style.display='none').catch(e=>alert(e.message));
    }
}
function openAuth(){authModal.style.display='flex';}
function logout(){signOut(auth);location.reload();}

onAuthStateChanged(auth,user=>{
    if(user){
        document.getElementById('nav').innerHTML=`
        <button onclick="showFeed()">Inicio</button>
        <button onclick="showExplore()">Explorar</button>
        <button onclick="showProfile()">Perfil</button>
        <button onclick="logout()">Salir</button>`;
    }
});
</script>
</body>
</html>
